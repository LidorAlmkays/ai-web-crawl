# Job 18.7: OTEL Integration Verification

## Objective

Verify that the OpenTelemetry Collector is properly scraping metrics from the task-manager service and that Prometheus is successfully collecting these metrics from the OTEL Collector.

## Requirements

### OTEL Collector Verification

- [ ] OTEL Collector is scraping task-manager metrics endpoint
- [ ] Task-manager metrics are being collected correctly
- [ ] OTEL Collector is exposing metrics on port 9464
- [ ] No scraping errors in OTEL Collector logs

### Prometheus Integration Verification

- [ ] Prometheus is scraping OTEL Collector on port 9464
- [ ] Task-manager metrics are visible in Prometheus
- [ ] Metrics have correct labels and values
- [ ] No scraping errors in Prometheus

### End-to-End Flow Verification

- [ ] Task-manager → OTEL Collector → Prometheus flow works
- [ ] Metrics are accessible via Prometheus API
- [ ] Metrics can be queried in Prometheus
- [ ] Grafana can access metrics from Prometheus

## Test Criteria

### ✅ OTEL Collector Scraping

- [ ] `http://localhost:9464/metrics` returns task-manager metrics
- [ ] `task_manager_up` metric shows value = 1
- [ ] `task_manager_scrape_duration_seconds` is present
- [ ] No connection errors to task-manager

### ✅ Prometheus Collection

- [ ] `http://localhost:9090/api/v1/query?query=task_manager_up` returns data
- [ ] Task-manager metrics are listed in Prometheus targets
- [ ] Scrape status shows "UP" for task-manager job
- [ ] No scraping errors in Prometheus logs

### ✅ Metrics Validation

- [ ] Web crawl metrics are present (new, completed, error tasks)
- [ ] Metrics have correct labels (instance, job)
- [ ] Metric values are reasonable and updating
- [ ] Time series data is being collected

## Implementation Details

### Verification Commands

```powershell
# Check OTEL Collector metrics
Invoke-WebRequest -Uri "http://localhost:9464/metrics" -UseBasicParsing

# Check Prometheus task-manager metrics
Invoke-WebRequest -Uri "http://localhost:9090/api/v1/query?query=task_manager_up" -UseBasicParsing

# Check available task-manager metrics
Invoke-WebRequest -Uri "http://localhost:9090/api/v1/label/__name__/values" -UseBasicParsing

# Check task-manager metrics endpoint directly
Invoke-WebRequest -Uri "http://localhost:3000/api/metrics" -UseBasicParsing
```

### Expected Metrics

- `task_manager_up` - Should be 1 if scraping is successful
- `task_manager_scrape_duration_seconds` - Duration of each scrape
- `task_manager_scrape_samples_scraped` - Number of metrics scraped
- `task_manager_web_crawl_new_tasks_total` - New tasks count
- `task_manager_web_crawl_completed_tasks_total` - Completed tasks count
- `task_manager_web_crawl_error_tasks_total` - Error tasks count

## Status: ✅ COMPLETED

### Test Results

- ✅ OTEL Collector successfully scraping task-manager metrics
- ✅ Prometheus successfully collecting from OTEL Collector
- ✅ task_manager_up metric showing value = 1
- ✅ Metrics flow: Task-Manager → OTEL Collector → Prometheus working
- ✅ All verification commands returning expected results

### Verification Summary

- **OTEL Collector**: Scraping task-manager on port 3000 every 5s
- **Prometheus**: Collecting from OTEL Collector on port 9464
- **Metrics**: All task-manager metrics visible and accessible
- **Integration**: End-to-end flow working correctly

## Next Steps

Proceed to **Job 19.1: Traces Implementation** to add distributed tracing to the task-manager application.
